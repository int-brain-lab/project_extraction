# Auditory oddball stimulation protocol
Auditory oddball stimulation is a passive sensory stimulation protocol designed to evoked auditory prediction errors, through a series of standard tone interrupted by occasional deivated stimuli. 
Usually both standard and deviant stimuli are composed of pure auditory tone, they can deivated in one of the auditory features, such as frequency, duration, and amplitude. 

This particular task composed of 4 trains of stimulation, with 2s delay between the trains. But one can modify the tone features and inter-stimuli delay separately.

First train is a series of 10 standard stimulation using the usual IBL stimuli onset tone (5Hz, 100ms, 0.5 amplitude), interrupted by 1 lower frequency stimuli at the 7th tone. 
Then, after 2s delay, the same string of 10 standard stimlui, interrupted by 1 higher frequency stimuli, again at the 7th tone. 
Both higher and lower deivants are set to differ from standard tone at 3 octave bands at different directions. 
Afterward, the stimulation protocols going into an ascending sequence follow by a descending sequence, ranging from 78Hz to 40kHz, deivated in 1 octave band. 
Deivant stimuli in the ascending sequence, 


This task can be modified to any string of pure tone stimulation with various delay intervals. 
The pure tones was generated by harp, are stored as .bin files. 
The sequence of how the tone was presented and interval between them is stored in a separate .csv, file path is set up under task_parameters.yaml.

# Facotr to consider when writing the auditory task 
Total duratioof the stimuli 
How many different tones? 
what are their frequency, duration and other propertie?
How are you going to put them in a train? 

This example is based on 10 tones. 
The whole protocol composes of 5 different sequences, all composed of 10 tones
1st sequence - standard tone (5KHz 100ms, IBL trial onset tone) interupted by a lower frequence tone (625Hz) at the 8th position
2nd sequence - standard tone (5KHz 100ms, IBL trial onset tone) interupted by a higher frequence tone (40k, outside human hearing) at the 8th position
3rd sequence - control asending frequency sequence used to test standard tone responses
4th sequence - control descending frequency sequence used to test standard tone responses
5th sequence - many standard control sequence gives all the 10 toens "randomly" (the random sequence is repeated), it starts with IBL trial onset tone

Each sequence is repeated 5 times and the 

# Step 1 - design your pure tones 
Use Harp to design the pure tones. 

At Harp sound card app, launch Sound generator and uploader
Generate a pure tone .bin file from there

Configure pure tone: 
- set frequency (Hz) on both left and right channels (IBL trial start tone is 5kHz)
- set Duration (ms) on both left and right channels (IBL trial start tone is 100ms)
click Generate to check the waveform 

Interface with the Sound card 
Click create files

A pure tone .bin file should be created in Harp Sound Card directory, e.g. C:\Users\IBLuser\Documents\HarpSoundCard\Interface\toSoundCard
with the format ixx_name your put in (xx is by default the sequence of tone you created on that harp device app)

** Sampling frequency is always 96kHz, if you need a different one, you need to change it at the task.py
** Save the tones in the same folder as your task.py and update the path on task_parameters.yaml file


# Step 2 - test the sound sequences

Save the sequence of tone you want to run in a csv file, in the following convension:
    Row A is titles: 
        Column A, sequence (refer to the number of train of sound, first train of sound starts with 0); 
        Column B, sound_name; 
        Column C, delay (which is the inter-tone delay). 
        
** Note, the Max number of tones per sequence is 50

Delay between each sequence is set in the task.py (), set to 2s in the current protocol

** Even octave separation works better than even frequence seapration
** Listen to your sound sequence to make sure it is as expected
** Save this csv file in the same folder as your task.py and update the path on task_parameters.yaml file


# Step 3 - incooperate into task pipeline 


# Step 4 - commit the task to custom tasks in iblrig


# Step 5 - Tests before recording/imaging


Test the new stimuli independently following iblrigv8 instruction 

New protocol should show up after you connect to Alyx


